# 3DObject

プリミティブな 3D モデルを AviUtl 上で生成できるスクリプトです。
スクリプトを用いて 3D モデルを配置し、簡易的なモデリングを行うことができます。

現在は **version 1.41** が最新です。

[![Twitter](https://pbs.twimg.com/media/DffKIZkU0AAzpZu?format=jpg&name=small)](https://twitter.com/Aodaruma_/status/1006495329267486720)

以下のスクリプトが備わっています。

## @3Dobject

### 図形関数設定(必須)

3Dobject スクリプトを使用する前の初期設定を行います。
以降のスクリプトを使用する前に、必ずこのスクリプトを実行できるように配置してください。

以下はパラメーターの説明です。

- **トラックバー/チェックボックス**

  - Affect%

    - 変形率を指定します。

  - AprType

    - 変形タイプを指定します。

  - Refl(rikky)

    - rikky 氏の光源反射関数を使い光源反射、または屈折反射関数を使い屈折を行います。
      rikky 氏開発のdll`rikky_module`が必要です。
    - 使用方法
      - _光源反射の場合_
        1.  "光源設置(3Dobject の物とは別に単体で設定してください)"を 3DObject を使用するオブジェクトより上の光源に設定するオブジェクトに設置します。
        2.  オブジェクトの図形関数設定の後に、"反射設定(図形関数設定の直後に設定してください)"を設定します。
        3.  図形関数設定の「反射(rikky)」の値を 1 にすると実行されます。
      - _屈折描画の場合_
        1.  オブジェクトの図形関数設定の後に、"屈折設定(図形関数設定の直後に設定してください)"を設定します。
        2.  図形関数設定の「反射(rikky)」の値を 2 にすると実行されます。

  - Mtrl(type)

    - オブジェクトにテクスチャを張り付け方を指定することができます。

      基本的に、図研関数設定より上に設定されたエフェクトをテクスチャとして設定します。
      ただし、光源反射と併用するととても重たくなるので、防止対策に Refl とは併用できなくなっています。

      0. 図形をテクスチャとして使用せず、図形の中心の色でテクスチャを作ります。

      1. 図形をテクスチャとして使用します。ただし、uv は縦横比に関係なく引き伸ばされます。
      2. 図形をテクスチャとして使用します。ただし、uv は縦横比を考慮して設定されます。
      3. 図形をテクスチャとして使用します。オブジェクトごとに特定の場合において、反対向きに uv を設定します。
      4. 図形をテクスチャとして使用します。オブジェクトごとに特定の場合において、3 とは違う方向で反対向きに uv を設定します。
      5. 特殊な uv において使用されます。設定する必要がなければ単色マテリアルとして設定されます。

- **ダイアログ**

  - DelayTrackT

    - 93 氏のスクリプト「DelayMove」の一つ「DelayTrackT」を使用して変形をずらすかどうか設定します。

      この機能を使用するには、93 氏のスクリプト「DelayMove」が必要です。

    -     *使用方法*

      1.  DelayTrackT を図形関数設定より上に設定します。
      2.  DelayTrackT の添え字を設定します。(そのまま設定しているなら変えなくても構いません。)
      3.  DelayTrackT のトラック番号を指定します。
      4.  指定したトラックを動かすと、ずれて変形されます。

  - DTT 添え字

    - DelayTrackT に使用する添え字をここで指定します。

  - DTT トラック

    - DelayTrackT で使用するトラックバーを指定します。

  - 非表示
    - ログ及び実行が成功したかのステータスを非表示にするかどうか設定します。

### 光源設置(3Dobject の物とは別に設定してください)

3Dobject で配置したオブジェクトへ、反射光源を設定するスクリプトです。

以下はパラメーターの説明です。

- **トラックバー/チェックボックス**

  - 光源度%

    - 光源の強さを設定します。

  - Damping

    - 光源の減衰率です。

  - 幅角度

    - 光源の半径を設定します。単位は度数法です。

  - 描画細度

    - 光源の減衰をどれだけ細かく計算するかを設定します。数値が小さいほど細かく計算できます。

- **ダイアログ**
  - dialog
    - 以下は `rikky_module` バージョン 1.3 以上の機能を使用した特殊なダイアログです。
      `rikky_module` バージョン 1.3 以上を導入していないと動作しません。
      - Main[color]
        - 光源の色を設定します。
      -     spot/direct[check]
        - 点光源か、面光源かを設定します。
        - チェックをつけると面光源が設定できます。
      -     BothSide[check]
        - 光源を反対方向にも設定します。

### 反射設定(図形関数設定の直後に設定してください)

対象のオブジェクトへ反射に関する設定を行います。

以下はパラメーターの説明です。

- **トラックバー/チェックボックス**

  - 影響度%
    - 反射の度合いを設定します。0%で反射されなくなります。
  - ﾊｲﾗｲﾄｼｬｰﾌﾟ

    - ハイライトの反射度合いです。値が小さいほど鋭く反射されます。

- **ダイアログ**

  - 以下は `rikky_module` バージョン 1.3 以上の機能を使用した特殊なダイアログです。

    `rikky_module` バージョン 1.3 以上を導入していないと動作しません。

    - Specular[color]

      - 反射色を設定します。

    -     Ambient[color]
      - 環境色を設定します。
    -     Emissive[color]
      - 発光色を設定します。
    -     Details[check]
      - 面光源の場合に、細かく反射を計算するかを設定します。
    -     └ Finess[track]

      - Details において、どれだけ細かく反射を計算するかを設定します。

        値が小さいとより細かく設定します。

### 光源初期化(最初の光源で光源設定の前に必ず設定してください)

反射光源となるオブジェクトを管理するための初期設定を行うスクリプトです。
反射光源となるオブジェクトより上のレイヤーで実行できるよう配置してください。

以下はパラメーターの説明です。

- **トラックバー/チェックボックス**
  - 透明化
    - オブジェクトを透明化します。`1`で透明になります。
  - メッセージ非表示
    - メッセージを非表示にするかどうか設定します。

### 屈折設定(図形関数設定の直後に設定してください)

対象オブジェクトに対して、屈折マテリアルを設定するスクリプトです。

以下はパラメーターの説明です。

- **トラックバー/チェックボックス**

  - blur
  - 屈折のぼかし具合を設定します。
  - refr(%)

    - 屈折率を設定します。

  - zoom%

    - 屈折描画処理の拡大率を設定します。

  - lens
    - ガラスの描画処理を設定します。
      1. 凸レンズ気味に描画します。
      2. 凹レンズ気味に描画します。

- **ダイアログ**

  - dialog

    - 以下は `rikky_module` バージョン 1.3 以上の機能を使用した特殊なダイアログです。

      `rikky_module` バージョン 1.3 以上を導入していないと動作しません。

      - Colorize[check]

        - ガラスに色を付けるかどうか設定します。

      - └ color[color]
      - 上記のガラスに色を付ける際に色を指定します。

      - reverse[check]
      - 反転処理をするかどうか設定します。

      - └ All/UD/LR[track]
      - 上記の反転処理の処理タイプを設定します。
      - 1 で上下左右、 2 で上下、 3 で左右に反転します。

      - offsetZ[track]
      - フレームバッファでの仮想的な高さを調整します。

      - boundary\[1-3\][track]
      - 屈折の際、画像の端の処理を設定します。

        1. 境界までくると反対側からループしてような処理になります
        2. 境界より先はイメージが反転した処理になります
        3. 境界の色を引き延ばした処理になります

        (rikky_module の使い方より引用)

      - async[check]
      - 屈折する画像を常時更新するよう設定します。

      - culling[check]
      - 裏面を表示しないようにします。

        ただし、この `3Dobject`スクリプト ではガバガバな面の処理をしているので、実行非推奨です。

### 立方体/直方体

立方体・直方体の 3D オブジェクトを生成します。

以下はパラメーターの説明です。

- **トラックバー/チェックボックス**

  - width
  - 横幅を指定します。pixel 単位です。
  - height
    - 縦幅を指定します。pixel 単位です。
  - depth

    - 深幅を指定します。pixel 単位です。

  - ログ表示
    - デバッグウィンドウなどにおいて、ログを表示するかどうか設定します。
  - 表示
    - 描画を実行するかどうか設定します。

### 球/多角体

球体・多角体の 3D オブジェクトを生成します。

以下はパラメーターの説明です。

- **トラックバー/チェックボックス**

  - radius
  - 半径を指定します。pixel 単位です。
  - width%

    - 横幅の倍率を指定します。

  - height%

    - 縦幅の倍率を指定します。

  - depth%

    - 深幅の倍率を指定します。

- **ダイアログ**

  - 分割数

    - 面体の分割数を指定します。自然数を入力してください。

  - ログ表示

    - デバッグウィンドウなどにおいて、ログを表示するか指定します。

  - ｶｯﾃｨﾝｸﾞ(縦)%

    - 球を縦にカットすることができます。

      例

      - {{0,100}}
        - 0%~100%の部分を表示します。
      -     {{20,30}, {50,60}}
        - 20%~30%の部分と、 50%~60%の部分を表示します。

  - 表示
    - 描画するかどうか設定します。

### 円錐/多角錐

円錐・多角錐の 3D オブジェクトを生成します。

以下はパラメーターの説明です。

- **トラックバー/チェックボックス**

  - radius
  - 底面の半径を指定します。pixel 単位です。
  - height

    - 縦幅を指定します。pixel 単位です。

  - width%

    - 横幅の倍率を指定します。

  - depth%

    - 深幅の倍率を指定します。

- **ダイアログ**

  - 分割数
    - 面体の分割数を指定します。自然数を入力してください。
  - ログ表示

    - デバッグウィンドウなどにおいて、ログを表示するか指定します。

  - 表示
    - 描画するかどうか設定します。

### 円柱/多角柱

円柱・多角柱の 3D オブジェクトを生成します。

以下はパラメーターの説明です。

- **トラックバー/チェックボックス**

  - radius
  - 底面の半径を指定します。pixel 単位です。
  - height

    - 縦幅を指定します。pixel 単位です。

  - width%

    - 横幅の倍率を指定します。

  - depth%

    - 深幅の倍率を指定します。

- **ダイアログ**

  - 分割数
  - 面体の分割数を指定します。自然数を入力してください。
  - ログ表示

    - デバッグウィンドウなどにおいて、ログを表示するか指定します。

  - 扇%

    - 扇型に描画する指定ができます。100%ですべて描画します。

  - 表示
    - 描画するかどうか設定します。

### トーラス

トーラス型の 3D オブジェクトを生成します。

以下はパラメーターの説明です。

- **トラックバー/チェックボックス**

  - radius
  - 底面の半径を指定します。pixel 単位です。
  - height%

    - トーラス幅を指定します。

  - width%

    - 横幅の倍率を指定します。

  - depth%

    - 深幅の倍率を指定します。

  - height%

    - 縦幅の倍率を指定します。

- **ダイアログ**

  - 分割数
  - 面体の分割数を指定します。自然数を入力してください。
  - ログ表示

    - デバッグウィンドウなどにおいて、ログを表示するか指定します。

  - 扇%

    - 扇型に描画する指定ができます。100%ですべて描画します。

  - 扇縦横逆転

    - 扇型に描画する指定を、縦に描画していくか横に描画していくかを指定することができます。

  - 表示
    - 描画するかどうか設定します。

## 導入方法 / how to install

[上の階層](https//github.com/Aodaruma/Aodaruma-AviUtl-Script)を参照してください。

## ライセンス / Licence

[上の階層](https//github.com/Aodaruma/Aodaruma-AviUtl-Script)を参照してください。[ここ](https//github.com/Aodaruma/Aodaruma-AviUtl-Script/blob/main/LICENSE)にも書いてあります。

## バグ・意見 / how to report bugs

バグや意見等については、Twitter の DM に送るか、issue を立ち上げてください。

## 変更履歴 / change log

- v1.41 - 配布を Github リポジトリーに変更。説明文を変更しました。
- v1.4 -
  - 個別オブジェクト対応
  - ガラス屈折描写追加
  - チュートリアルの aup を追加
  - その他いくつかの処理を軽量化
- v1.3 -
  - 光源反射を rikky_module の上位版関数に設定
  - マテリアル設定を追加
  - rikky_module における特殊ダイアログ機能を追加
  - その他バグ等修正
- v1.2 -
  - 光源反射機能を追加。
  - 球をカットする機能を追加。
  - 変形方法を追加。
  - その他バグを修正。
- v1.1 -
  - 二つ表示されてしまうバグを修正。
  - トーラス型を追加。
  - 円柱、トーラス型に扇形機能を追加。
- v1.0 -
  - スクリプトを作成。
  - 直方体、球、円錐、円柱などを追加。
